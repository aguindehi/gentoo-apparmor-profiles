# Last Modified: Sat Mar 25 13:38:15 2017
#include <tunables/global>

#########################################
# Generic Firejail AppArmor profile
#########################################

profile firejail-default {
  #include <abstractions/consoles>

  capability audit_control,
  capability audit_write,
  capability chown,
  capability dac_override,
  capability dac_read_search,
  capability fowner,
  capability fsetid,
  capability ipc_lock,
  capability ipc_owner,
  capability kill,
  capability lease,
  capability linux_immutable,
  capability mac_admin,
  capability mac_override,
  capability mknod,
  capability net_admin,
  capability net_bind_service,
  capability net_broadcast,
  capability net_raw,
  capability setfcap,
  capability setgid,
  capability setpcap,
  capability setuid,
  capability sys_admin,
  capability sys_boot,
  capability sys_chroot,
  capability sys_module,
  capability sys_nice,
  capability sys_pacct,
  capability sys_ptrace,
  capability sys_rawio,
  capability sys_resource,
  capability sys_time,
  capability sys_tty_config,

  network inet,
  network inet6,
  network netlink,
  network raw,
  network unix,

  mount,
  remount,
  umount,

  signal,

  pivot_root,

  / r,
  /[^proc,^sys]** mrwlk,
  /bin/** ix,
  /lib/** ix,
  /lib64/** ix,
  /usr/bin/** ix,
  /usr/games/** ix,
  /usr/lib/** ix,
  /usr/lib64/gstreamer-1.0/gst-plugin-scanner Px,
  /usr/lib64/kde4/libexec/lnusertemp ix,
  /usr/local/** ix,
  /usr/sbin/** ix,
  /opt/ r,
  /opt/** ix,
  /opt/** r,
  /opt/firefox/update.test rw,
  /opt/firefox/update.test/ rw,
  /opt/thunderbird/update.test rw,
  /opt/thunderbird/update.test/ rw,

  @{PROC}/ r,
  @{PROC}/@{PID}/auxv r,
  @{PROC}/@{PID}/net/arp r,
  @{PROC}/@{PID}/net/route r,
  @{PROC}/@{PID}/task/*/comm rw,
  @{PROC}/@{PID}/ r,
  @{PROC}/@{PID}/cmdline r,
  @{PROC}/@{PID}/comm r,
  @{PROC}/@{PID}/fd/ r,
  @{PROC}/@{PID}/maps r,
  @{PROC}/@{PID}/mountinfo r,
  @{PROC}/@{PID}/mounts r,
  @{PROC}/@{PID}/oom_score_adj r,
  @{PROC}/@{PID}/stat r,
  @{PROC}/@{PID}/statm r,
  @{PROC}/@{PID}/status r,
  @{PROC}/@{PID}/smaps r,
  @{PROC}/@{PID}/task/ r,
  @{PROC}/@{PID}/task/@{PID}/stat r,
  @{PROC}/asound/card[0-9]/ r,
  @{PROC}/asound/card[0-9]/** r,
  @{PROC}/cpuinfo r,
  @{PROC}/filesystems r,
  @{PROC}/loadavg r,
  @{PROC}/meminfo r,
  @{PROC}/stat r,
  @{PROC}/sys/kernel/osrelease r,
  @{PROC}/sys/kernel/pid_max r,
  @{PROC}/sys/kernel/shmmax r,
  @{PROC}/sys/vm/overcommit_memory r,
  @{PROC}/sys/vm/overcommit_ratio r,
  @{PROC}/uptime r,

  /sbin/** ix,
  /sys/ r,
  /sys/bus/ r,
  /sys/bus/** r,
  /sys/class/ r,
  /sys/class/** r,
  /sys/devices/ r,
  /sys/devices/** r,

  /{,var/}run/ r,
  /{,var/}run/** r,
  /{,var/}run/firejail/appimage r,
  /{,var/}run/firejail/appimage/** rix,
  /{,var/}run/firejail/mnt/fslogger r,
  /{,var/}run/user/**/dconf/ rw,
  /{,var/}run/user/**/dconf/user rw,
  /{,var/}run/user/**/pulse/ rw,
  /{,var/}run/user/**/pulse/** rw,
  /{run,dev}/shm/ r,
  /{run,dev}/shm/** mrwk,

}
